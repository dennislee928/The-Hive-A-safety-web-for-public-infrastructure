# Evaluation

本文件定義 PoC 評估的詳細規格，包含指標計算公式、評估方法、ERH 圖表規格與報告模板。

## 評估指標

### 1. TTA：時間至確認（Time-to-Acknowledge）

**定義**：從信號產生到操作人員確認（D0 Pre-Alert）的時間。

**計算公式**：
```
TTA = timestamp_D0_acknowledge - timestamp_signal_first_received
```

**測量方法**：
- 記錄第一個信號接收時間戳
- 記錄 D0 確認時間戳
- 計算時間差（單位：秒）

**目標值**：
- **低嚴重度情境**：TTA < 60 秒
- **中嚴重度情境**：TTA < 30 秒
- **高嚴重度情境**：TTA < 15 秒

**統計方法**：
- 平均值：`mean(TTA)`
- 中位數：`median(TTA)`
- 95% 分位數：`percentile(TTA, 95)`

---

### 2. TTDR：時間至派遣建議（Time-to-Dispatch Recommendation）

**定義**：從信號產生到 D1 派遣建議生成的時間。

**計算公式**：
```
TTDR = timestamp_D1_recommendation - timestamp_signal_first_received
```

**測量方法**：
- 記錄第一個信號接收時間戳
- 記錄 D1 建議生成時間戳
- 計算時間差（單位：秒）

**目標值**：
- **低嚴重度情境**：TTDR < 120 秒
- **中嚴重度情境**：TTDR < 90 秒
- **高嚴重度情境**：TTDR < 60 秒

**統計方法**：
- 平均值：`mean(TTDR)`
- 中位數：`median(TTDR)`
- 95% 分位數：`percentile(TTDR, 95)`

---

### 3. FN/FP 依情境嚴重度

**定義**：
- **FN（False Negative）**：系統未能及時升級或派遣資源，導致實際需要時未採取行動
- **FP（False Positive）**：系統不必要地升級或派遣資源，導致恐慌、權利侵犯或資源浪費

**計算公式**：
```
FN_rate = false_negatives / (false_negatives + true_positives)
FP_rate = false_positives / (false_positives + true_negatives)
```

**測量方法**：
- 基於實際事件結果驗證（事後分析）
- 比較系統決策與實際需求
- 依情境嚴重度分類（低/中/高）

**目標值**：
- **低嚴重度情境**：FN_rate < 0.1, FP_rate < 0.15
- **中嚴重度情境**：FN_rate < 0.05, FP_rate < 0.10
- **高嚴重度情境**：FN_rate < 0.02, FP_rate < 0.05

**統計方法**：
- 依情境嚴重度分別計算 FN_rate 與 FP_rate
- 使用置信區間（95% CI）評估統計顯著性

---

### 4. 偏見指標（Bias Indicators）

**定義**：系統對特定群體、區域或時間段產生系統性誤差。

**計算公式**（代理指標，PoC 規格）：
```
Bias_group = max(FN_rate_group_i - FN_rate_group_j) for all groups
Bias_zone = max(FN_rate_zone_i - FN_rate_zone_j) for all zones
Bias_time = max(FN_rate_time_i - FN_rate_time_j) for all time_periods
```

**測量方法**：
- 依群體（代理指標：信號來源類型）計算 FN_rate
- 依區域（Z1/Z2/Z3/Z4）計算 FN_rate
- 依時間段（例如：高峰/離峰）計算 FN_rate
- 計算群體/區域/時間段間的最大差異

**目標值**：
- Bias_group < 0.1
- Bias_zone < 0.1
- Bias_time < 0.1

**統計方法**：
- 使用統計檢驗（例如：卡方檢驗）檢驗群體/區域/時間段間的差異
- 使用置信區間（95% CI）評估統計顯著性

**限制**：
- PoC 階段使用代理指標（信號來源類型、區域、時間段）
- 實際部署需使用更精確的群體定義（需符合隱私要求）

---

### 5. 完整性失敗檢測（Integrity Failures Detected）

**定義**：系統檢測到的信號偽造、命令偽造或系統入侵事件。

**計算公式**：
```
Integrity_detection_rate = detected_failures / total_failures
```

**測量方法**：
- 記錄檢測到的完整性失敗事件（信號偽造、命令偽造、系統入侵）
- 記錄總失敗事件（需人工驗證或事後分析）
- 計算檢測率

**目標值**：
- Integrity_detection_rate > 0.95（95% 檢測率）

**統計方法**：
- 計算檢測率與置信區間（95% CI）
- 分析未檢測到的失敗事件類型

---

## 評估情境選擇標準

### 情境代表性

**情境應涵蓋**：
1. **所有區域**（Z1/Z2/Z3/Z4）
2. **所有決策點**（D0-D6）
3. **不同複雜度層級**（低/中/高 x_total）
4. **不同嚴重度**（低/中/高）
5. **不同倫理質數**（FN/FP/Bias/Integrity）

### 情境選擇標準

**1. 區域覆蓋**：
- 至少 1 個情境涵蓋每個區域（Z1/Z2/Z3/Z4）
- 至少 1 個情境涵蓋多區域協調（D4）

**2. 複雜度覆蓋**：
- 至少 1 個低複雜度情境（x_total < 0.3）
- 至少 1 個中複雜度情境（0.3 ≤ x_total < 0.6）
- 至少 1 個高複雜度情境（0.6 ≤ x_total < 0.8）
- 至少 1 個極高複雜度情境（x_total ≥ 0.8）

**3. 嚴重度覆蓋**：
- 至少 1 個低嚴重度情境
- 至少 1 個中嚴重度情境
- 至少 1 個高嚴重度情境

**4. 倫理質數覆蓋**：
- 至少 1 個情境主要測試 FN-prime
- 至少 1 個情境主要測試 FP-prime
- 至少 1 個情境主要測試 Bias-prime
- 至少 1 個情境主要測試 Integrity-prime

### 情境數量建議

**最少情境數**：12 個（涵蓋所有區域、複雜度層級、嚴重度、倫理質數）

**建議情境數**：20-30 個（增加統計顯著性與代表性）

---

## ERH 圖表格式與視覺化規格

### 1. 時間序列圖（Time Series Plot）

**用途**：顯示 x_total 與各倫理質數隨時間變化。

**圖表規格**：
- **X 軸**：時間（ISO8601 格式）
- **Y 軸**：指標值（x_total 或質數值，0.0-1.0）
- **線條**：
  - x_total（黑色實線）
  - FN-prime（紅色虛線）
  - FP-prime（藍色虛線）
  - Bias-prime（綠色虛線）
  - Integrity-prime（橙色虛線）
- **標記**：斷點（垂直線，紅色）

**範例標題**：「ERH 趨勢分析：x_total 與各倫理質數隨時間變化」

---

### 2. 散點圖（Scatter Plot）

**用途**：顯示各倫理質數與 x_total 的關係。

**圖表規格**：
- **X 軸**：x_total（0.0-1.0）
- **Y 軸**：質數值（0.0-1.0）
- **點**：每個情境的 (x_total, 質數值) 對
- **顏色**：依情境嚴重度（低=綠色、中=黃色、高=紅色）
- **趨勢線**：線性迴歸線（顯示趨勢）

**範例標題**：「ERH 關係分析：FN-prime 與 x_total 的關係」

---

### 3. 直方圖（Histogram）

**用途**：顯示複雜度分佈。

**圖表規格**：
- **X 軸**：x_total 區間（例如：0.0-0.2, 0.2-0.4, ...）
- **Y 軸**：情境數量
- **顏色**：依複雜度等級（低=綠色、中=黃色、高=橙色、極高=紅色）

**範例標題**：「複雜度分佈：x_total 分佈直方圖」

---

### 4. 熱力圖（Heatmap）

**用途**：顯示跨情境的 ERH 比較。

**圖表規格**：
- **X 軸**：情境識別碼
- **Y 軸**：指標（x_total, FN-prime, FP-prime, Bias-prime, Integrity-prime）
- **顏色**：指標值（綠色=低、黃色=中、紅色=高）

**範例標題**：「跨情境 ERH 比較：所有情境與指標的熱力圖」

---

## 基準線（Baseline）定義與比較方法

### 基準線定義

**基準線**：不使用群眾信號（僅使用基礎設施與人員信號）的系統版本。

**基準線特徵**：
- x_s 較低（僅基礎設施與人員信號）
- x_d 相同（決策點流程相同）
- x_c 較低（情境狀態較少）

**基準線目標**：
- 建立「無群眾信號」系統的效能基準
- 比較「有群眾信號」系統的改善效果

### 比較方法

**1. 指標比較**：
- 比較 TTA、TTDR、FN_rate、FP_rate 等指標
- 使用統計檢驗（例如：t-test）檢驗顯著性
- 計算改善幅度（百分比）

**2. ERH 比較**：
- 比較 x_total 與各倫理質數
- 使用散點圖顯示關係差異
- 識別改善或惡化的區域

**3. 情境比較**：
- 比較相同情境下的系統表現
- 使用配對 t-test 檢驗顯著性
- 計算情境特定改善幅度

---

## 統計顯著性測試與置信區間

### 統計檢驗方法

**1. t-test（獨立樣本）**：
- 用於比較兩個系統版本（例如：基準線 vs. 完整系統）
- 假設：樣本獨立且常態分佈
- 顯著性水準：α = 0.05

**2. 配對 t-test**：
- 用於比較相同情境下的系統表現
- 假設：配對樣本差異常態分佈
- 顯著性水準：α = 0.05

**3. 卡方檢驗**：
- 用於檢驗群體/區域/時間段間的差異
- 假設：類別變數獨立
- 顯著性水準：α = 0.05

### 置信區間

**計算方法**：
- 使用 Bootstrap 方法計算置信區間（95% CI）
- 重複取樣 1000 次
- 計算 2.5% 與 97.5% 分位數

**報告格式**：
- 指標值 ± 置信區間（例如：TTA = 45.2 ± 5.3 秒，95% CI [39.9, 50.5]）

---

## 評估報告模板

### 報告結構

**1. 執行摘要**
- 評估目標與範圍
- 關鍵發現與結論
- 建議行動

**2. 方法論**
- 評估情境選擇標準
- 評估指標定義
- 統計方法說明

**3. 指標分析**
- TTA、TTDR 分析
- FN/FP 分析
- 偏見指標分析
- 完整性失敗檢測分析

**4. ERH 分析**
- x_total 與各質數的趨勢分析
- 斷點識別與影響分析
- 緩解措施效果評估

**5. 基準線比較**
- 指標比較結果
- ERH 比較結果
- 情境特定比較結果

**6. 統計分析**
- 統計顯著性測試結果
- 置信區間分析
- 相關性分析

**7. 結論與建議**
- 關鍵發現總結
- 改善建議
- 後續評估計劃

### 報告交付物

**1. 文字報告**：
- Markdown 格式
- 包含所有章節與分析結果

**2. 圖表檔案**：
- 時間序列圖（PNG 或 SVG）
- 散點圖（PNG 或 SVG）
- 直方圖（PNG 或 SVG）
- 熱力圖（PNG 或 SVG）

**3. 資料檔案**：
- 原始資料（CSV 格式）
- 處理後資料（CSV 格式）
- 統計分析結果（JSON 格式）

---

## 假設

- 評估情境可重現（相同輸入產生相同輸出）
- 實際事件結果可驗證（用於計算 FN/FP）
- 統計方法適用於評估資料

## 攻擊考量

- 評估資料偽造：需資料完整性驗證與審計日誌
- 統計分析操縱：需透明的方法論與可重現的分析

## 隱私影響

- 評估資料僅包含聚合後統計，不涉及個別資料
- 評估報告需去識別化處理

