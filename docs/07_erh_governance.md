# ERH Governance

本文件定義 ERH（Ethical Risk Horizon）治理框架，用於管理系統複雜度增加時的誤判成長。

## 複雜度向量定義

### x_s：有效信號來源數量

**定義**：在時間窗口內有信號的獨立來源數量（聚合後）。

**計算方法**：
```
x_s = number_of_effective_signal_sources
```

**有效信號來源條件**：
- 在時間窗口內有信號
- 信號來源獨立（不相關）
- 信號品質 ≥ 0.5（見 [docs/04_signal_model.md](04_signal_model.md)）
- 信號信任評分 ≥ 0.4（群眾信號，見 [docs/04_signal_model.md](04_signal_model.md)）

**參考**：詳細計算方法見 [docs/04_signal_model.md](04_signal_model.md)「信號複雜度貢獻（x_s）」章節。

**範圍**：理論上無上限，實務上預期 1-20。

---

### x_d：決策深度

**定義**：決策圖的深度，即已啟用的最高決策點等級。

**計算方法**：
```
x_d = max(已啟用決策點的 x_d 值)
```

**決策點 x_d 貢獻**（見 [docs/03_decision_points.md](03_decision_points.md)）：
- **D0**：x_d = 1
- **D1**：x_d = 2
- **D2**：x_d = 3
- **D3**：x_d = 4
- **D4**：x_d = 5
- **D5**：x_d = 6
- **D6**：x_d = 1（降級，不增加複雜度）

**範例**：
- 若同時啟用 D0、D1、D2、D3，則 x_d = 4

**範圍**：1-6（對應 D0-D5）。

---

### x_c：情境狀態數量

**定義**：系統需處理的情境/上下文狀態數量。

**計算方法**：
```
x_c = number_of_context_states
```

**情境狀態定義**：
- 每個區域（Z1/Z2/Z3/Z4）視為 1 個基礎狀態
- 每個決策點狀態（D0-D5）視為 1 個狀態
- 每個信號類型組合視為 1 個狀態
- 每個時間窗口視為 1 個狀態（簡化：僅考慮當前窗口）

**簡化計算**（PoC 規格）：
```
x_c = (number_of_active_zones) * (number_of_active_decision_points) * (number_of_signal_type_combinations)
```

**範例**：
- 若 Z1 與 Z3 同時啟用，D0/D1/D2 啟用，信號類型組合為 3（基礎設施+人員+群眾），則 x_c = 2 * 3 * 3 = 18

**範圍**：理論上無上限，實務上預期 1-100。

---

## 複雜度標量（x_total）

### 加權公式

**計算方法**：
```
x_total = w_s * normalize(x_s) + w_d * normalize(x_d) + w_c * normalize(x_c)
```

**權重**（PoC 規格）：
- w_s = 0.3（信號來源權重）
- w_d = 0.4（決策深度權重，最高）
- w_c = 0.3（情境狀態權重）

**標準化方法**：
- **x_s 標準化**：`normalize(x_s) = min(x_s / 20, 1.0)`（上限 20）
- **x_d 標準化**：`normalize(x_d) = x_d / 6`（上限 6）
- **x_c 標準化**：`normalize(x_c) = min(x_c / 100, 1.0)`（上限 100）

**範圍**：0.0 - 1.0（標準化後）

**範例**：
- 若 x_s = 10, x_d = 4, x_c = 18
- normalize(x_s) = 10/20 = 0.5
- normalize(x_d) = 4/6 = 0.67
- normalize(x_c) = 18/100 = 0.18
- x_total = 0.3 * 0.5 + 0.4 * 0.67 + 0.3 * 0.18 = 0.15 + 0.268 + 0.054 = 0.472

---

## 倫理質數（Ethical Primes）

### FN-prime：漏報風險（False Negative）

**定義**：系統未能及時升級或派遣資源，導致實際需要時未採取行動。

**測量指標**：
- **漏報率**：`FN_rate = false_negatives / (false_negatives + true_positives)`
- **漏報嚴重度**：`FN_severity = average_severity_of_missed_incidents`
- **漏報延遲**：`FN_delay = average_time_to_correct_action_after_miss`

**計算方法**（PoC 規格）：
```
FN_prime = (FN_rate * 0.5) + (FN_severity * 0.3) + (normalize(FN_delay) * 0.2)
```

**標準化**：
- FN_rate：0.0-1.0（直接使用）
- FN_severity：0.0-1.0（嚴重度標準化，1.0 = 最高嚴重度）
- normalize(FN_delay) = min(FN_delay / 300, 1.0)（延遲以秒計，上限 300 秒）

**目標值**：FN_prime < 0.2（低漏報風險）

**緩解措施**：
- 降低佐證閾值（但需平衡 FP-prime）
- 增加信號來源（提高 x_s）
- 縮短時間窗口（提高響應速度）

---

### FP-prime：誤報風險（False Positive）

**定義**：系統不必要地升級或派遣資源，導致恐慌、權利侵犯或資源浪費。

**測量指標**：
- **誤報率**：`FP_rate = false_positives / (false_positives + true_negatives)`
- **誤報影響**：`FP_impact = average_impact_of_unnecessary_actions`
- **誤報成本**：`FP_cost = resource_waste + rights_violations + panic_induction`

**計算方法**（PoC 規格）：
```
FP_prime = (FP_rate * 0.4) + (FP_impact * 0.4) + (normalize(FP_cost) * 0.2)
```

**標準化**：
- FP_rate：0.0-1.0（直接使用）
- FP_impact：0.0-1.0（影響標準化，1.0 = 最高影響）
- normalize(FP_cost) = min(FP_cost / 1000, 1.0)（成本標準化，上限 1000 單位）

**目標值**：FP_prime < 0.15（低誤報風險）

**緩解措施**：
- 提高佐證閾值（但需平衡 FN-prime）
- 加強雙人控制與死手保持機制
- 增加人工審核環節

---

### Bias-prime：偏見風險（Bias）

**定義**：系統對特定群體或區域產生系統性誤差。

**測量指標**：
- **群體間差異**：`Bias_group = max(FN_rate_group_i - FN_rate_group_j) for all groups`
- **區域間差異**：`Bias_zone = max(FN_rate_zone_i - FN_rate_zone_j) for all zones`
- **時間段差異**：`Bias_time = max(FN_rate_time_i - FN_rate_time_j) for all time_periods`

**計算方法**（PoC 規格）：
```
Bias_prime = (Bias_group * 0.4) + (Bias_zone * 0.4) + (Bias_time * 0.2)
```

**標準化**：
- 所有差異指標：0.0-1.0（差異標準化，1.0 = 最大差異）

**目標值**：Bias_prime < 0.1（低偏見風險）

**緩解措施**：
- 確保信號來源多樣性（避免單一群體/區域主導）
- 定期審計決策分佈（檢測系統性差異）
- 調整聚合權重（平衡不同來源）

---

### Integrity-prime：完整性風險（Integrity）

**定義**：系統受到偽造信號或命令入侵，導致決策被操縱。

**測量指標**：
- **偽造檢測率**：`Integrity_detection = detected_forgeries / total_forgeries`
- **入侵檢測率**：`Integrity_intrusion = detected_intrusions / total_intrusions`
- **命令完整性**：`Integrity_command = verified_commands / total_commands`

**計算方法**（PoC 規格）：
```
Integrity_prime = (1 - Integrity_detection) * 0.4 + (1 - Integrity_intrusion) * 0.4 + (1 - Integrity_command) * 0.2
```

**標準化**：
- 所有檢測/驗證率：0.0-1.0（直接使用）
- Integrity_prime 為「未檢測率」的加權平均（越高越危險）

**目標值**：Integrity_prime < 0.05（低完整性風險）

**緩解措施**：
- 加強信號來源驗證（硬體完整性檢查）
- 加強命令驗證（數位簽章、雙人控制）
- 加強審計日誌（所有操作記錄）

---

## ERH 報告格式

### 報告結構

**ERH 報告**應包含以下章節：

1. **執行摘要**
   - 當前 x_total 值
   - 各倫理質數的當前值與目標值比較
   - 關鍵發現與建議

2. **複雜度分析**
   - x_s, x_d, x_c 的當前值與趨勢
   - x_total 的計算結果
   - 複雜度分佈（跨情境）

3. **倫理質數分析**
   - FN-prime, FP-prime, Bias-prime, Integrity-prime 的當前值
   - 各質數的趨勢分析（隨 x_total 變化）
   - 質數間的權衡分析

4. **斷點識別**
   - 複雜度斷點（x_total 閾值）
   - 質數斷點（質數值閾值）
   - 斷點影響分析

5. **緩解措施**
   - 已實施的緩解措施
   - 緩解措施效果評估
   - 建議的緩解措施

6. **情境比較**
   - 跨情境的 ERH 比較
   - 情境間的差異分析
   - 情境特定建議

### 報告頻率

- **即時監控**：每 5 分鐘更新複雜度指標
- **每日報告**：每日生成 ERH 摘要報告
- **每週報告**：每週生成詳細 ERH 分析報告
- **每月報告**：每月生成 ERH 趨勢分析報告

---

## ERH 儀表板規格

### 儀表板組件

**1. 複雜度指標面板**
- x_s, x_d, x_c 的即時值
- x_total 的即時值與趨勢圖
- 複雜度分佈（直方圖）

**2. 倫理質數面板**
- FN-prime, FP-prime, Bias-prime, Integrity-prime 的即時值
- 各質數的趨勢圖（時間序列）
- 質數與 x_total 的關係圖（散點圖）

**3. 斷點警示面板**
- 複雜度斷點警示（x_total 超過閾值）
- 質數斷點警示（質數值超過閾值）
- 斷點影響分析

**4. 緩解措施面板**
- 已實施的緩解措施狀態
- 緩解措施效果評估
- 建議的緩解措施

### 視覺化規格

**圖表類型**：
- **時間序列圖**：顯示 x_total 與各質數隨時間變化
- **散點圖**：顯示質數與 x_total 的關係
- **直方圖**：顯示複雜度分佈
- **熱力圖**：顯示跨情境的 ERH 比較

**顏色編碼**：
- **綠色**：指標在目標範圍內
- **黃色**：指標接近閾值（需注意）
- **紅色**：指標超過閾值（需立即行動）

---

## 複雜度閾值與斷點識別

### 複雜度閾值

**低複雜度**（x_total < 0.3）：
- 系統運作穩定
- 倫理質數應在目標範圍內
- 無需特殊緩解措施

**中複雜度**（0.3 ≤ x_total < 0.6）：
- 系統運作正常，但需密切監控
- 倫理質數可能接近閾值
- 建議實施基本緩解措施

**高複雜度**（0.6 ≤ x_total < 0.8）：
- 系統運作壓力增加
- 倫理質數可能超過閾值
- 必須實施緩解措施

**極高複雜度**（x_total ≥ 0.8）：
- 系統運作風險高
- 倫理質數很可能超過閾值
- 必須實施嚴格緩解措施，考慮降級或簡化

### 斷點識別方法

**方法 1：統計斷點檢測**
- 使用統計方法（例如：CUSUM）檢測 x_total 或質數值的突變
- 突變點視為斷點

**方法 2：閾值斷點**
- 當 x_total 或質數值超過預設閾值時，標記為斷點
- 閾值基於歷史資料與目標值

**方法 3：斜率斷點**
- 當 x_total 或質數值的變化率（斜率）超過預設閾值時，標記為斷點
- 斜率閾值基於歷史資料

### 斷點影響分析

**影響評估**：
- 斷點對系統運作的影響（例如：決策延遲、誤判增加）
- 斷點對倫理質數的影響（例如：FN-prime 或 FP-prime 增加）
- 斷點對使用者的影響（例如：權利侵犯、恐慌誘發）

**影響等級**：
- **低影響**：系統可自行恢復
- **中影響**：需人工介入
- **高影響**：需立即行動

---

## 緩解措施

### 緩解措施類型

**1. 聚合（Aggregation）**
- **目的**：減少有效信號來源數量（降低 x_s）
- **方法**：加強信號聚合，減少獨立來源
- **效果**：降低 x_total，但可能增加 FN-prime（需平衡）

**2. 嚴格閘道（Stricter Gating）**
- **目的**：增加決策深度要求（提高 x_d 的實際門檻）
- **方法**：加強雙人控制、死手保持、TTL 機制
- **效果**：降低 FP-prime，但可能增加決策延遲

**3. 精細情境建模（Refined Context Modeling）**
- **目的**：減少情境狀態數量（降低 x_c）
- **方法**：簡化情境分類，減少狀態組合
- **效果**：降低 x_total，但可能降低系統靈活性

**4. 人工審核（Human Review）**
- **目的**：在斷點處增加人工審核環節
- **方法**：在 x_total 超過閾值時，強制人工審核所有高影響決策
- **效果**：降低 FP-prime 與 Integrity-prime，但增加決策延遲

**5. 降級（Degradation）**
- **目的**：在極高複雜度時，降級系統功能
- **方法**：關閉非關鍵功能，簡化決策流程
- **效果**：降低 x_total，但可能降低系統效能

### 緩解措施觸發條件

**自動觸發**：
- x_total ≥ 0.6：自動實施基本緩解措施
- x_total ≥ 0.8：自動實施嚴格緩解措施
- 質數值超過閾值：自動實施對應緩解措施

**手動觸發**：
- 操作人員可手動啟用緩解措施
- 需記錄理由與效果評估

### 緩解措施效果評估

**評估指標**：
- x_total 的變化（目標：降低）
- 各質數的變化（目標：降低至目標範圍內）
- 決策延遲的變化（目標：最小化）
- 系統效能的變化（目標：維持）

**評估方法**：
- 比較緩解措施實施前後的指標
- 使用統計方法（例如：t-test）檢驗顯著性
- 記錄效果評估結果

---

## 跨情境的 ERH 趨勢分析框架

### 趨勢分析目標

**目標**：識別 ERH 隨時間與情境變化的趨勢，預測未來風險。

### 分析方法

**1. 時間序列分析**
- 分析 x_total 與各質數隨時間的變化趨勢
- 使用統計方法（例如：ARIMA）預測未來值
- 識別季節性與週期性模式

**2. 情境比較分析**
- 比較不同情境（區域、時間、事件類型）的 ERH
- 識別高風險情境
- 提供情境特定建議

**3. 相關性分析**
- 分析 x_total 與各質數的相關性
- 識別關鍵影響因子
- 提供針對性緩解建議

### 報告格式

**趨勢分析報告**應包含：
- 時間序列圖（x_total 與各質數）
- 情境比較圖（跨情境的 ERH）
- 相關性分析結果
- 預測結果與建議

---

## 假設

- 複雜度指標可即時計算
- 倫理質數可事後測量（需實際事件驗證）
- 緩解措施效果可量化評估
- 系統運作資料可完整記錄

## 攻擊考量

- 複雜度指標操縱：需指標計算的完整性驗證
- 倫理質數偽造：需質數測量的審計日誌
- 緩解措施繞過：需緩解措施實施的強制執行機制

## 隱私影響

- ERH 報告僅包含聚合後統計，不涉及個別資料
- 趨勢分析需去識別化處理
- 報告資料需符合資料保留期限（見 [docs/08_privacy_legal_abuse.md](08_privacy_legal_abuse.md)）

