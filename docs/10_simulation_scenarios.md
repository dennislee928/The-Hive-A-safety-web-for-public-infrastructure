# Simulation Scenarios (Library)

本文件定義模擬情境庫，用於 PoC 評估。每個情境應指定區域類型、拓撲、人群狀態、信號來源、決策圖配置、情境狀態與預期評估結果。

## 情境選擇標準

每個情境應涵蓋：
- 區域類型（Z1–Z4）
- 拓撲與瓶頸點（粗略）
- 人群密度與流量
- 可用資源與回應時間
- 可用信號（x_s）
- 決策圖配置（x_d）
- 情境變數（x_c）
- 預期安全/不安全結果（用於評估）

詳細模板見 [templates/scenario_template.md](../templates/scenario_template.md)。

---

## 情境範例

### 情境 1：Z1 站內低複雜度情境（煙霧偵測）

**情境 ID**：SCENARIO-001

**區域**：
- zone_type: Z1（站內）
- topology_summary: 大廳層票閘區，單一主要出口，無轉乘通道

**人群狀態**：
- density: 中等（每平方公尺 2-3 人）
- flow: 穩定雙向流（進出站）
- bottlenecks: 票閘機群（5 個閘機，容量 300 人/分鐘）

**信號**：
- signal_sources (x_s): 3
  - 基礎設施：煙霧感測器（大廳層，1 個）
  - 人員：站務人員報告（1 名）
  - 群眾：App 報告（1 筆，信任評分 0.7）
- aggregation_window: 60 秒

**決策圖**：
- depth (x_d): 3（D0 → D1 → D2）
- high-impact_gates: 無（僅低影響決策）

**情境狀態**：
- context_variables:
  - 區域：Z1（1 個）
  - 決策點：D0/D1/D2（3 個）
  - 信號類型組合：基礎設施+人員+群眾（1 個組合）
- count (x_c): 1 * 3 * 1 = 3

**複雜度計算**：
- x_s = 3, normalize(x_s) = 3/20 = 0.15
- x_d = 3, normalize(x_d) = 3/6 = 0.5
- x_c = 3, normalize(x_c) = 3/100 = 0.03
- x_total = 0.3 * 0.15 + 0.4 * 0.5 + 0.3 * 0.03 = 0.045 + 0.2 + 0.009 = 0.254（低複雜度）

**預期評估**：
- target_outcomes:
  - TTA < 60 秒
  - TTDR < 120 秒
  - 正確識別煙霧事件（FN_rate < 0.1）
  - 不觸發誤報（FP_rate < 0.15）
- FN/FP/bias/integrity_expectations:
  - FN-prime < 0.2（低漏報風險）
  - FP-prime < 0.15（低誤報風險）
  - Bias-prime < 0.1（低偏見風險）
  - Integrity-prime < 0.05（低完整性風險）

---

### 情境 2：Z2 列車中複雜度情境（緊急停車）

**情境 ID**：SCENARIO-002

**區域**：
- zone_type: Z2（列車）
- topology_summary: 6 節車廂編組，車廂間通道，緊急出口（第 3 節車廂）

**人群狀態**：
- density: 高（每平方公尺 4-5 人，滿載）
- flow: 列車運行中，無明顯移動
- bottlenecks: 車門區域（每節車廂 2 個車門，容量 50 人/分鐘）

**信號**：
- signal_sources (x_s): 5
  - 基礎設施：列車運行狀態（位置、速度、緊急停車狀態，1 個）、車廂環境感測器（煙霧、溫度，2 個）
  - 人員：列車駕駛員報告（1 名）
  - 群眾：App 報告（2 筆，信任評分 0.6、0.8）
- aggregation_window: 30 秒

**決策圖**：
- depth (x_d): 4（D0 → D1 → D2 → D3）
- high-impact_gates: D3（區域升級，需雙人控制）

**情境狀態**：
- context_variables:
  - 區域：Z2（1 個）
  - 決策點：D0/D1/D2/D3（4 個）
  - 信號類型組合：基礎設施+人員+群眾（1 個組合）
- count (x_c): 1 * 4 * 1 = 4

**複雜度計算**：
- x_s = 5, normalize(x_s) = 5/20 = 0.25
- x_d = 4, normalize(x_d) = 4/6 = 0.67
- x_c = 4, normalize(x_c) = 4/100 = 0.04
- x_total = 0.3 * 0.25 + 0.4 * 0.67 + 0.3 * 0.04 = 0.075 + 0.268 + 0.012 = 0.355（中複雜度）

**預期評估**：
- target_outcomes:
  - TTA < 30 秒
  - TTDR < 90 秒
  - 正確識別緊急停車事件（FN_rate < 0.05）
  - 不觸發誤報（FP_rate < 0.10）
  - 正確升級至 D3（需雙人控制）
- FN/FP/bias/integrity_expectations:
  - FN-prime < 0.2（低漏報風險）
  - FP-prime < 0.15（低誤報風險）
  - Bias-prime < 0.1（低偏見風險）
  - Integrity-prime < 0.05（低完整性風險）

---

### 情境 3：Z3 站周邊高複雜度情境（大型活動疏散）

**情境 ID**：SCENARIO-003

**區域**：
- zone_type: Z3（站周邊）
- topology_summary: 主要出入口、公車轉乘站、道路交叉口、鄰近開放空間

**人群狀態**：
- density: 極高（每平方公尺 6-8 人，活動結束後疏散）
- flow: 單向流出（站內向外的疏散流）
- bottlenecks: 主要出入口（2 個，容量 500 人/分鐘）、公車轉乘站（容量 200 人/分鐘）

**信號**：
- signal_sources (x_s): 8
  - 基礎設施：出入口流量計數（2 個）、公車轉乘站監控（1 個）、道路監控（1 個）、環境感測器（1 個）
  - 人員：站外保全（2 名）、公車站務人員（1 名）
  - 群眾：App 報告（5 筆，信任評分 0.5-0.9）
- aggregation_window: 90 秒

**決策圖**：
- depth (x_d): 5（D0 → D1 → D2 → D3 → D5）
- high-impact_gates: D3（區域升級）、D5（公開警告，需雙人控制）

**情境狀態**：
- context_variables:
  - 區域：Z3（1 個）
  - 決策點：D0/D1/D2/D3/D5（5 個）
  - 信號類型組合：基礎設施+人員+群眾（1 個組合）
- count (x_c): 1 * 5 * 1 = 5

**複雜度計算**：
- x_s = 8, normalize(x_s) = 8/20 = 0.4
- x_d = 5, normalize(x_d) = 5/6 = 0.83
- x_c = 5, normalize(x_c) = 5/100 = 0.05
- x_total = 0.3 * 0.4 + 0.4 * 0.83 + 0.3 * 0.05 = 0.12 + 0.332 + 0.015 = 0.467（高複雜度）

**預期評估**：
- target_outcomes:
  - TTA < 15 秒
  - TTDR < 60 秒
  - 正確識別疏散需求（FN_rate < 0.02）
  - 不觸發誤報（FP_rate < 0.05）
  - 正確升級至 D3 與 D5（需雙人控制）
  - 發布 CAP 警告（與 Route 1 同步）
- FN/FP/bias/integrity_expectations:
  - FN-prime < 0.2（低漏報風險，但需密切監控）
  - FP-prime < 0.15（低誤報風險，但需密切監控）
  - Bias-prime < 0.1（低偏見風險）
  - Integrity-prime < 0.05（低完整性風險）

---

### 情境 4：Z4 其他高密度區極高複雜度情境（大型活動緊急事件）

**情境 ID**：SCENARIO-004

**區域**：
- zone_type: Z4（其他高密度區）
- topology_summary: 活動場地（室內，容納 5000 人）、主要出入口（4 個）、疏散通道（8 個）、鄰近開放空間（公園）

**人群狀態**：
- density: 極高（每平方公尺 8-10 人，活動進行中）
- flow: 向心聚集（朝向舞台/核心區），緊急事件後離心擴散
- bottlenecks: 主要出入口（4 個，容量 800 人/分鐘）、疏散通道（8 個，容量 400 人/分鐘）

**信號**：
- signal_sources (x_s): 12
  - 基礎設施：活動場地監控（人群密度，2 個）、出入口流量計數（4 個）、環境感測器（煙霧、溫度，2 個）、活動管理系統（1 個）
  - 人員：活動工作人員（3 名）、保全（2 名）、協調單位（警察、消防，2 名）
  - 群眾：App 報告（10 筆，信任評分 0.4-0.9）
- aggregation_window: 120 秒

**決策圖**：
- depth (x_d): 6（D0 → D1 → D2 → D3 → D4 → D5）
- high-impact_gates: D3（區域升級）、D4（多區域協調，需嚴格審批）、D5（公開警告，需雙人控制）

**情境狀態**：
- context_variables:
  - 區域：Z4（1 個）
  - 決策點：D0/D1/D2/D3/D4/D5（6 個）
  - 信號類型組合：基礎設施+人員+群眾（1 個組合）
- count (x_c): 1 * 6 * 1 = 6

**複雜度計算**：
- x_s = 12, normalize(x_s) = 12/20 = 0.6
- x_d = 6, normalize(x_d) = 6/6 = 1.0
- x_c = 6, normalize(x_c) = 6/100 = 0.06
- x_total = 0.3 * 0.6 + 0.4 * 1.0 + 0.3 * 0.06 = 0.18 + 0.4 + 0.018 = 0.598（極高複雜度）

**預期評估**：
- target_outcomes:
  - TTA < 15 秒
  - TTDR < 60 秒
  - 正確識別緊急事件（FN_rate < 0.02）
  - 不觸發誤報（FP_rate < 0.05）
  - 正確升級至 D3、D4 與 D5（需嚴格審批與雙人控制）
  - 發布 CAP 警告（與 Route 1 同步）
  - 多單位協調（警察、消防、醫療）
- FN/FP/bias/integrity_expectations:
  - FN-prime < 0.2（低漏報風險，但需密切監控，可能接近閾值）
  - FP-prime < 0.15（低誤報風險，但需密切監控，可能接近閾值）
  - Bias-prime < 0.1（低偏見風險）
  - Integrity-prime < 0.05（低完整性風險）

**緩解措施**：
- 實施嚴格緩解措施（人工審核、降級功能）
- 密切監控 x_total 與各質數值
- 準備降級方案（簡化決策流程）

---

### 情境 5：多區域協調情境（Z1+Z3 網路級協調）

**情境 ID**：SCENARIO-005

**區域**：
- zone_type: Z1（站內）+ Z3（站周邊）
- topology_summary: 站內大廳層與月台層、站周邊主要出入口與公車轉乘站

**人群狀態**：
- density: 高（Z1：每平方公尺 4-5 人，Z3：每平方公尺 5-6 人）
- flow: 站內向外的疏散流（Z1 → Z3）
- bottlenecks: Z1 票閘區（5 個閘機）、Z3 主要出入口（2 個）、公車轉乘站（1 個）

**信號**：
- signal_sources (x_s): 10
  - 基礎設施：Z1 票閘流量（1 個）、Z1 環境感測器（1 個）、Z3 出入口流量（2 個）、Z3 公車轉乘站監控（1 個）、Z3 道路監控（1 個）
  - 人員：Z1 站務人員（2 名）、Z3 保全（2 名）
  - 群眾：App 報告（Z1：3 筆，Z3：4 筆，信任評分 0.5-0.9）
- aggregation_window: 60 秒（Z1）、90 秒（Z3）

**決策圖**：
- depth (x_d): 5（D0 → D1 → D2 → D3 → D4）
- high-impact_gates: D3（區域升級，Z1 與 Z3 分別）、D4（多區域協調，需嚴格審批）

**情境狀態**：
- context_variables:
  - 區域：Z1 + Z3（2 個）
  - 決策點：D0/D1/D2/D3/D4（5 個）
  - 信號類型組合：基礎設施+人員+群眾（1 個組合）
- count (x_c): 2 * 5 * 1 = 10

**複雜度計算**：
- x_s = 10, normalize(x_s) = 10/20 = 0.5
- x_d = 5, normalize(x_d) = 5/6 = 0.83
- x_c = 10, normalize(x_c) = 10/100 = 0.1
- x_total = 0.3 * 0.5 + 0.4 * 0.83 + 0.3 * 0.1 = 0.15 + 0.332 + 0.03 = 0.512（高複雜度）

**預期評估**：
- target_outcomes:
  - TTA < 30 秒（Z1 與 Z3 分別）
  - TTDR < 90 秒（Z1 與 Z3 分別）
  - 正確識別跨區域事件（FN_rate < 0.05）
  - 不觸發誤報（FP_rate < 0.10）
  - 正確升級至 D3（Z1 與 Z3 分別，需雙人控制）
  - 正確協調至 D4（需嚴格審批，3 人）
  - 區域間資訊共享與資源調度
- FN/FP/bias/integrity_expectations:
  - FN-prime < 0.2（低漏報風險，但需密切監控）
  - FP-prime < 0.15（低誤報風險，但需密切監控）
  - Bias-prime < 0.1（低偏見風險，需注意區域間差異）
  - Integrity-prime < 0.05（低完整性風險，需注意區域間通訊）

---

## 情境比較分析框架

### 比較維度

**1. 複雜度比較**：
- 比較各情境的 x_total 值
- 識別複雜度斷點

**2. 倫理質數比較**：
- 比較各情境的 FN-prime、FP-prime、Bias-prime、Integrity-prime
- 識別質數斷點

**3. 效能比較**：
- 比較各情境的 TTA、TTDR、FN_rate、FP_rate
- 識別效能瓶頸

**4. 區域比較**：
- 比較不同區域（Z1/Z2/Z3/Z4）的系統表現
- 識別區域特定問題

### 比較方法

**1. 統計檢驗**：
- 使用 t-test 或 ANOVA 檢驗情境間差異
- 使用置信區間評估統計顯著性

**2. 視覺化**：
- 使用散點圖顯示複雜度與質數的關係
- 使用熱力圖顯示跨情境的 ERH 比較

**3. 趨勢分析**：
- 分析複雜度與質數的趨勢
- 識別斷點與緩解措施效果

---

## 假設

- 所有情境可重現（相同輸入產生相同輸出）
- 所有情境的實際事件結果可驗證（用於計算 FN/FP）
- 所有情境的統計方法適用

## 攻擊考量

- 情境資料偽造：需資料完整性驗證與審計日誌
- 情境結果操縱：需透明的方法論與可重現的分析

## 隱私影響

- 情境資料僅包含聚合後統計，不涉及個別資料
- 情境報告需去識別化處理

